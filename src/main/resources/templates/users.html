<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>
  <div th:fragment="content">
    <div class="feature">
      <h3><i class="fas fa-users"></i> User Management</h3>

      <!-- Add User Form -->
      <div
        style="background: var(--background-color); padding: 20px; border-radius: var(--border-radius); margin-bottom: 20px;">
        <h4>Add New User</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: end;">
          <div>
            <label class="form-label">Name</label>
            <input type="text" id="userName" placeholder="Enter name">
          </div>
          <div>
            <label class="form-label">Email</label>
            <input type="email" id="userEmail" placeholder="Enter email">
          </div>
          <button class="btn btn-primary" onclick="addUser()">
            <i class="fas fa-plus"></i> Add User
          </button>
        </div>
      </div>

      <!-- Users List -->
      <div id="users-container">
        <p>Loading users...</p>
      </div>

      <button class="btn btn-secondary" onclick="loadUsers()">
        <i class="fas fa-refresh"></i> Refresh Users
      </button>
    </div>

    <script>
      async function loadUsers() {
        try {
          const users = await window.AppUtils.apiCall('/api/users');
          const container = document.getElementById('users-container');

          if (users.length === 0) {
            container.innerHTML = '<p style="color: var(--text-secondary);">No users found.</p>';
            return;
          }

          container.innerHTML = users.map(user => `
                        <div style="border: 1px solid var(--border-color); padding: 16px; margin: 8px 0; border-radius: var(--border-radius); display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${user.name}</strong> - ${user.email}<br>
                                <small style="color: var(--text-secondary);">
                                    Created: ${window.AppUtils.formatDate(user.createdAt)}
                                </small>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `).join('');
        } catch (error) {
          document.getElementById('users-container').innerHTML =
            '<p style="color: var(--danger-color);">Failed to load users</p>';
        }
      }

      async function addUser() {
        const name = document.getElementById('userName').value;
        const email = document.getElementById('userEmail').value;

        if (!name || !email) {
          window.AppUtils.showAlert('Please fill in all fields', 'warning');
          return;
        }

        try {
          await window.AppUtils.apiCall('/api/users', {
            method: 'POST',
            body: JSON.stringify({ name, email })
          });

          window.AppUtils.showAlert('User added successfully', 'success');
          document.getElementById('userName').value = '';
          document.getElementById('userEmail').value = '';
          loadUsers();
        } catch (error) {
          window.AppUtils.showAlert('Failed to add user', 'danger');
        }
      }

      async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) return;

        try {
          await window.AppUtils.apiCall(`/api/users/${userId}`, {
            method: 'DELETE'
          });

          window.AppUtils.showAlert('User deleted successfully', 'success');
          loadUsers();
        } catch (error) {
          window.AppUtils.showAlert('Failed to delete user', 'danger');
        }
      }

      // Load users when page loads
      document.addEventListener('DOMContentLoaded', loadUsers);
    </script>
  </div>
</body>

</html>